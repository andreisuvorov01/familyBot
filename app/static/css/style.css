/* === 1. CORE VARIABLES (Telegram Adaptive) === */
:root {
    --bg-page: var(--tg-theme-secondary-bg-color, #f1f1f2);
    --bg-card: var(--tg-theme-bg-color, #ffffff);
    --text-primary: var(--tg-theme-text-color, #000000);
    --text-secondary: var(--tg-theme-hint-color, #8e8e93);
    --accent: var(--tg-theme-button-color, #007aff);
    --accent-text: var(--tg-theme-button-text-color, #ffffff);
    --divider: rgba(0, 0, 0, 0.1);

    /* Physics & Geometry */
    --spring-easing: cubic-bezier(0.175, 0.885, 0.32, 1.1); /* Пружина */
    --smooth-easing: cubic-bezier(0.25, 0.1, 0.25, 1);
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 20px);
}

/* Dark Mode Adjustments */
@media (prefers-color-scheme: dark) {
    :root { --divider: rgba(255, 255, 255, 0.15); }
}

/* === 2. RESET & BASE === */
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body, html {
    margin: 0; padding: 0; width: 100%;
    /* ВАЖНО: Разрешаем скролл и убираем фиксацию */
    height: auto;
    min-height: 100%;
    overflow-y: auto;
    background-color: var(--bg-page);
    color: var(--text-primary);
}

/* === 3. PLATFORM SPECIFIC: iOS (The "Apple" Look) === */
body.is-ios {
    --radius-l: 20px;
    --radius-m: 14px;
    --radius-s: 10px;
    font-family: -apple-system, "SF Pro Text", sans-serif;
    letter-spacing: -0.02em;
}

body.is-ios header h1 {
    font-weight: 800;
    font-size: 32px;
}

/* iOS: Glassmorphism Modals */
body.is-ios .bottom-sheet {
    background-color: var(--bg-card); /* Fallback */
}
@supports (backdrop-filter: blur(20px)) {
    body.is-ios .bottom-sheet {
        background-color: var(--tg-theme-bg-color); /* Semi-transparent base */
        backdrop-filter: saturate(180%) blur(20px); /* Frosted Glass */
    }
}

/* === 4. PLATFORM SPECIFIC: Android (Material You) === */
body.is-android {
    --radius-l: 28px; /* Material shapes are rounder */
    --radius-m: 16px;
    --radius-s: 4px;
    font-family: 'Roboto', sans-serif;
}

/* === 5. LAYOUT & SCROLL === */
.app-container {
    /* Контейнер просто растягивается по высоте контента */
    height: auto;
    min-height: 100vh;
    overflow: visible;
    padding: 16px;
    padding-top: calc(12px + var(--safe-top));
    padding-bottom: calc(100px + var(--safe-bottom)); /* Место под кнопку */
}
.app-container::-webkit-scrollbar { display: none; }

/* === 6. UI COMPONENTS === */

/* Inputs */
input, textarea, select {
    -webkit-appearance: none; appearance: none;
    border: none; outline: none;
    background-color: var(--bg-card);
    color: var(--text-primary);
    border-radius: var(--radius-m);
    padding: 14px 16px;
    width: 100%;
    font-size: 17px !important;
    transition: transform 0.1s;
    margin-bottom: 12px;
}
input, textarea, select {
    font-size: 16px !important;
}

/* Buttons */
button { border: none; background: none; cursor: pointer; font-family: inherit; }

/* Tabs */
.tab-container {
    background-color: rgba(120, 120, 128, 0.12);
    border-radius: 10px;
    padding: 2px;
    display: flex;
    margin-bottom: 20px;
}
.tab-btn {
    flex: 1; padding: 7px;
    font-size: 13px; font-weight: 600;
    border-radius: 8px;
    color: var(--text-primary);
    text-align: center;
    opacity: 0.6;
    transition: all 0.3s var(--smooth-easing);
    position: relative;
    z-index: 1;
}
.tab-btn.active {
    background-color: var(--bg-card);
    opacity: 1;
    box-shadow: 0 3px 8px rgba(0,0,0,0.12); /* Shadow only for active */
    transform: scale(1);
}

/* Task Cards */
.task-card {
    background-color: var(--bg-card);
    border-radius: var(--radius-l);
    padding: 16px;
    margin-bottom: 12px;
    display: flex; align-items: center; gap: 14px;
    transition: transform 0.2s var(--spring-easing), opacity 0.2s;
    position: relative;
    overflow: hidden;
}
/* Active state: Squeeze effect */
.task-card:active { transform: scale(0.96); }

/* Android Ripple effect emulation */
body.is-android .task-card { box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
body.is-ios .task-card { box-shadow: none; } /* Flat on iOS list */

/* FAB (Floating Button) */
.fab {
    position: fixed; bottom: calc(20px + var(--safe-bottom)); right: 20px;
    width: 56px; height: 56px; border-radius: 50%;
    background: var(--accent); color: white;
    display: grid; place-content: center; font-size: 24px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
    z-index: 90;
    transition: transform 0.3s var(--spring-easing);
}
.fab:active { transform: scale(0.8) rotate(90deg); }

/* === 7. MODALS (Bottom Sheet) === */
.modal-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.3);
    opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 100;
    backdrop-filter: blur(4px);
}
.modal-overlay.active { opacity: 1; pointer-events: auto; }

.bottom-sheet {
    position: fixed; bottom: 0; left: 0; right: 0;
    background-color: var(--bg-card);
    border-top-left-radius: 24px; border-top-right-radius: 24px;
    padding: 24px; padding-bottom: calc(30px + var(--safe-bottom));
    transform: translateY(110%);
    transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1); /* Apple-like slide */
    z-index: 200; max-height: 92%; overflow-y: auto;
    box-shadow: 0 -10px 40px rgba(0,0,0,0.1);
}
.bottom-sheet.active { transform: translateY(0); }

.sheet-handle {
    width: 40px; height: 5px; background-color: var(--text-secondary);
    opacity: 0.3; border-radius: 10px; margin: 0 auto 20px auto;
}

/* === 8. ANIMATIONS === */

/* Staggered List Animation */
@keyframes slideInUp {
    from { opacity: 0; transform: translateY(20px) scale(0.95); }
    to { opacity: 1; transform: translateY(0) scale(1); }
}

.animate-enter {
    animation: slideInUp 0.4s var(--spring-easing) forwards;
}

/* === UTILS === */
.text-main { color: var(--text-primary); }
.text-hint { color: var(--text-secondary); }
.text-accent { color: var(--accent); }

/* Checkbox */
.custom-checkbox {
    width: 24px; height: 24px;
    border: 2px solid var(--text-secondary); border-radius: 50%; /* Circle checkbox like iOS Reminders */
    display: grid; place-content: center; transition: 0.2s;
}
.custom-checkbox:checked {
    background-color: var(--accent); border-color: var(--accent);
}
.custom-checkbox::before {
    content: "✓"; color: white; font-size: 14px; transform: scale(0); transition: 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.custom-checkbox:checked::before { transform: scale(1); }

/* Visibility Selector */
.visibility-selector { display: flex; gap: 8px; margin-bottom: 16px; }
.visibility-option {
    background-color: var(--bg-page);
    padding: 12px; border-radius: var(--radius-m);
    text-align: center; font-size: 14px; font-weight: 500;
    border: 2px solid transparent; transition: 0.2s;
    display: flex; align-items: center; justify-content: center; gap: 6px;
    opacity: 0.7;
}
.visibility-selector input:checked + .visibility-option {
    border-color: var(--accent); color: var(--accent);
    background-color: rgba(51, 144, 236, 0.08);
    opacity: 1; transform: scale(1.02);
}

/* Calendar */
.calendar-grid {
    display: grid !important;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px; /* Компактные отступы */
    margin-bottom: 20px;
}

.calendar-day {
    /* Идеальный круг */
    aspect-ratio: 1;
    border-radius: 50%;

    background-color: var(--bg-card);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center; /* Центрируем всё */

    font-size: 15px;
    font-weight: 400;
    color: var(--text-primary);
    position: relative;
    cursor: pointer;
    transition: transform 0.1s;
}

.calendar-day:active { transform: scale(0.9); }

/* Цифра дня (немного поднимаем, чтобы точки влезли) */
.calendar-day span {
    margin-bottom: 2px; /* Место под точки */
    line-height: 1;
}

/* Контейнер точек */
.task-dots {
    display: flex;
    gap: 3px;
    height: 4px; /* Фиксированная высота */
}

/* Сами точки */
.dot {
    width: 4px; height: 4px;
    border-radius: 50%;
    background-color: var(--accent); /* Синий по умолчанию */
}

.dot.private { background-color: var(--text-hint); } /* Серый */
.dot.late { background-color: #ef4444; } /* Красный */

/* === СОСТОЯНИЯ === */

/* Сегодняшний день (Только текст синий, без фона) */
.calendar-day.today {
    color: var(--accent);
    font-weight: 700;
}

/* Выбранный день (Синий круг) */
.calendar-day.selected {
    background-color: var(--accent);
    color: white;
    font-weight: 600;
}

/* ВАЖНО: Делаем точки белыми на синем фоне */
.calendar-day.selected .dot {
    background-color: white !important;
    opacity: 0.8;
}
.hidden { display: none !important; }
.form-group {
    background-color: var(--bg-card);
    border-radius: 12px;
    overflow: hidden; /* Чтобы дети не вылезали за скругление */
    margin-bottom: 16px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05); /* Легкая тень */
}

/* Строка внутри группы */
.form-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    height: 50px; /* Фиксированная высота для аккуратности */
    border-bottom: 1px solid var(--divider);
    position: relative;
}
.form-row:last-child { border-bottom: none; }

/* Инпуты внутри строк (прозрачные, без рамок) */
.form-row input,
.form-row select {
    background: transparent !important;
    border: none !important;
    text-align: right; /* Значение справа, как в iOS */
    padding: 0 !important;
    margin: 0 !important;
    height: 100%;
    font-size: 16px !important;
    color: var(--accent); /* Синий цвет для значений */
    direction: ltr; /* Чтобы дата не прыгала */
}

/* Лейблы слева */
.form-label {
    font-size: 16px;
    color: var(--text-main);
    font-weight: 500;
    flex-shrink: 0; /* Чтобы текст не сжимался */
}

/* Большие поля (Заголовок/Описание) */
.input-standalone {
    width: 100%;
    background-color: var(--bg-card);
    border-radius: 12px;
    padding: 14px 16px;
    font-size: 17px !important;
    color: var(--text-main);
    border: 1px solid transparent;
    transition: 0.2s;
    margin-bottom: 12px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.03);
}
.input-standalone:focus {
    border-color: var(--accent);
    background-color: var(--bg-card);
}

/* Видимость (Segmented Control) */
.segment-control {
    display: flex;
    background-color: rgba(118, 118, 128, 0.12); /* Серый трек */
    padding: 3px;
    border-radius: 9px;
    margin-bottom: 24px;
}
.segment-option {
    flex: 1;
    text-align: center;
    padding: 8px;
    font-size: 13px;
    font-weight: 500;
    border-radius: 7px;
    color: var(--text-main);
    transition: 0.2s;
    display: flex; align-items: center; justify-content: center; gap: 6px;
}
/* Скрытый радио-инпут управляет стилем соседа */
input[type="radio"]:checked + .segment-option {
    background-color: var(--bg-card);
    box-shadow: 0 3px 8px rgba(0,0,0,0.12);
    font-weight: 600;
}
/* === NEW VISIBILITY SELECTOR (Big Cards) === */
.visibility-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 24px;
}

.vis-card {
    background-color: var(--bg-card);
    padding: 16px;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    border: 2px solid transparent;
    transition: all 0.2s var(--spring-easing);
    box-shadow: 0 2px 8px rgba(0,0,0,0.03);
}

.vis-card i { font-size: 24px; margin-bottom: 4px; }
.vis-card span { font-weight: 600; font-size: 14px; }

/* Активное состояние - Семья (Синий) */
input[value="common"]:checked + .vis-card {
    background-color: var(--accent);
    color: white;
    box-shadow: 0 8px 20px rgba(51, 144, 236, 0.3);
    transform: translateY(-2px);
}

/* Активное состояние - Личное (Темный/Серый) */
input[value="private"]:checked + .vis-card {
    background-color: var(--text-main); /* Черный на светлой, Белый на темной */
    color: var(--bg-card); /* Инверсия текста */
    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    transform: translateY(-2px);
    border: 1px solid transparent;
}

/* Дополнительно для темной темы, чтобы было красиво */
@media (prefers-color-scheme: dark) {
    input[value="private"]:checked + .vis-card {
        background-color: #3a3a3c; /* Темно-серый, как в iOS настройках */
        color: #fff;
    }
}

/* === FAKE INPUTS (Trigger Buttons) === */
.fake-input {
    background-color: var(--bg-card);
    border-radius: 12px;
    padding: 14px 16px;
    font-size: 16px;
    color: var(--text-main);
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    cursor: pointer;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}
.fake-input:active { opacity: 0.7; transform: scale(0.98); }
.fake-input span { pointer-events: none; }
.fake-input .value { color: var(--accent); font-weight: 600; }
.fake-input .placeholder { color: var(--text-hint); font-weight: 400; }

/* === ACTION SHEETS (Custom Selects) === */
.action-sheet-item {
    padding: 16px;
    border-bottom: 1px solid var(--divider);
    font-size: 17px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
}
.action-sheet-item:last-child { border-bottom: none; }
.action-sheet-item:active { background-color: var(--bg-page); }
.action-sheet-item.selected { color: var(--accent); font-weight: 600; }
.action-sheet-item.selected::after {
    content: "\f00c"; font-family: "Font Awesome 6 Free"; font-weight: 900;
}

/* Custom Time Picker inside Sheet */
.time-picker-row {
    display: flex; justify-content: center; gap: 10px; padding: 20px;
}
.time-picker-row select {
    width: auto; background-color: var(--bg-page); border-radius: 8px; font-weight: bold; font-size: 20px;
}
.date-quick-actions {
    display: flex; gap: 8px; margin-bottom: 20px;
}
.date-btn {
    flex: 1;
    background-color: var(--bg-app);
    color: var(--text-main);
    padding: 12px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 15px;
    text-align: center;
    transition: 0.2s;
    border: 1px solid transparent;
}
.date-btn:active { background-color: var(--text-hint); opacity: 0.2; }

/* Кастомный выбор времени (Большие цифры) */
.time-selector-container {
    background-color: var(--bg-app);
    border-radius: 16px;
    padding: 16px;
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.time-label {
    font-size: 15px; font-weight: 600; color: var(--text-hint); text-transform: uppercase;
}
.time-inputs {
    display: flex; align-items: center; gap: 4px;
}
/* Скрываем стандартный селект, показываем только текст */
.time-select {
    appearance: none; -webkit-appearance: none;
    background: transparent; border: none;
    font-size: 28px; font-weight: 700;
    color: var(--accent);
    padding: 0; margin: 0;
    width: auto;
    text-align: center;
}
.time-separator {
    font-size: 24px; font-weight: 700; color: var(--text-hint); padding-bottom: 4px;
}

/* Календарь в пикере */
.picker-calendar-container {
    background-color: var(--bg-app);
    border-radius: 16px;
    padding: 16px;
    margin-bottom: 20px;
}

/* Кнопка Очистить (Красная) */
.btn-destructive {
    width: 100%;
    padding: 16px;
    border-radius: 14px;
    font-weight: 600;
    font-size: 16px;
    color: #ef4444;
    background-color: rgba(239, 68, 68, 0.1);
    transition: 0.2s;
}
.btn-destructive:active { background-color: rgba(239, 68, 68, 0.2); }
/* Custom Time Input */
.time-input {
    width: 50px !important; /* Фикс ширины */
    height: 40px !important;
    padding: 0 !important;
    margin: 0 !important;
    text-align: center;
    font-size: 22px !important;
    font-weight: 700;
    color: var(--accent);
    background: transparent !important;
    border: none !important;
    border-radius: 8px;
}
.time-input:focus {
    background-color: rgba(128, 128, 128, 0.1) !important;
}
/* === WHEEL PICKER (Compact & Precise) === */
.wheel-picker-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 16px;
    padding: 0;
    position: relative;
    height: 120px; /* Компактная высота */
    background: var(--bg-card);
    /* Жесткая маска для эффекта "барабана" */
    -webkit-mask-image: linear-gradient(to bottom, transparent, black 40%, black 60%, transparent);
    mask-image: linear-gradient(to bottom, transparent, black 40%, black 60%, transparent);
    border-radius: 12px;
}

/* Центральная линия */
.wheel-highlight {
    position: absolute;
    top: 50%; left: 20px; right: 20px;
    height: 34px; /* Высота строки */
    transform: translateY(-50%);
    background: rgba(128, 128, 128, 0.1);
    border-radius: 8px;
    z-index: 0;
    pointer-events: none;
}

.wheel-column {
    height: 100%;
    width: 60px;
    overflow-y: auto;
    /* Важно: заставляем скролл останавливаться ровно на элементах */
    scroll-snap-type: y mandatory;
    -webkit-overflow-scrolling: touch;
    z-index: 1;
    /* Отступы, чтобы первый элемент мог встать в центр */
    /* (Высота контейнера 120 - Высота элемента 34) / 2 = 43px */
    padding-top: 43px;
    padding-bottom: 43px;
    /* Скрываем скроллбар */
    scrollbar-width: none;
}
.wheel-column::-webkit-scrollbar { display: none; }

.wheel-item {
    height: 34px; /* Фиксированная высота элемента */
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    font-weight: 500;
    color: var(--text-hint);
    scroll-snap-align: center; /* Центрирование */
    transition: all 0.1s;
    cursor: pointer;
}

.wheel-item.active {
    color: var(--accent);
    font-size: 22px;
    font-weight: 700;
    transform: scale(1.1);
}

.wheel-separator {
    font-size: 20px; font-weight: 700; color: var(--text-main); margin-top: -2px; z-index: 2;
}

